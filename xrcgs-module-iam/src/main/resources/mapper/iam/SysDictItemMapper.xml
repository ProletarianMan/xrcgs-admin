<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xrcgs.iam.mapper.SysDictItemMapper">

    <select id="selectByQuery" resultType="com.xrcgs.iam.entity.SysDictItem">
        SELECT id, type_code AS typeCode, label, value, sort, ext, status,
        dept_id AS deptId,
        created_at AS createdAt, updated_at AS updatedAt
        FROM sys_dict_item
        WHERE 1 = 1
        <if test="q != null">
            <if test="q.typeCode != null and q.typeCode != ''">
                AND type_code = #{q.typeCode}
            </if>
            <if test="q.keyword != null and q.keyword != ''">
                AND (label LIKE CONCAT('%', #{q.keyword}, '%')
                OR value LIKE CONCAT('%', #{q.keyword}, '%'))
            </if>
            <if test="q.status != null">
                AND status = #{q.status}
            </if>
        </if>
        ORDER BY sort ASC, id ASC
    </select>


    <!-- 分页：按 typeCode + label 模糊，启用项优先；排序：sort asc, id asc -->
    <select id="selectPageByQuery" resultType="com.xrcgs.iam.entity.SysDictItem">
        SELECT
        id, type_code AS typeCode, label, value, ext, sort, status,
        dept_id AS deptId,
        created_at AS createdAt, updated_at AS updatedAt
        FROM sys_dict_item
        WHERE 1 = 1
        <if test="q != null and q.typeCode != null and q.typeCode != ''">
            AND type_code = #{q.typeCode}
        </if>
        <if test="q != null and q.label != null and q.label != ''">
            AND label LIKE CONCAT('%', #{q.label}, '%')
        </if>
        ORDER BY status DESC, sort ASC, id ASC
    </select>

</mapper>
